# Quick Reference - Fiji Court System

## TL;DR - What Changed?

✅ Court hierarchy support (Appeal → High Court → Magistrates → Tribunals)  
✅ Case numbers auto-generated by court type (HAC, HBC, ABU, etc.)  
✅ Hearing action types (MENTION, TRIAL, RULING, etc.)  
✅ Court rooms tracking  
✅ Legal representatives directory  
✅ Enhanced party tracking with counsel  
✅ Bail decision tracking  
✅ Daily cause list generation  
✅ Appeal linkage to original cases  

## Quick Start

### 1. Run Migration
```bash
npm run db-push
```

### 2. Seed Courts
```bash
npx ts-node scripts/seed-fiji-courts.ts
```

### 3. Use New Features

```typescript
// Generate case number
import { generateCaseNumber } from "@/lib/utils/case-number";
const caseNum = await generateCaseNumber(orgId, "high_court", "criminal");
// Returns: "HAC 001/2025"

// Create case with parties
await db.insert(cases).values({
  caseNumber: caseNum,
  courtLevel: "high_court",
  division: "criminal",
  parties: {
    prosecution: [{ name: "State", counsel: "DPP" }],
    defense: [{ name: "John Doe", counsel: "LEGAL AID" }]
  },
  offences: ["Rape", "Assault"],
  // ... other fields
});

// Schedule hearing with action type
await db.insert(hearings).values({
  actionType: "MENTION",
  scheduledDate: new Date(),
  scheduledTime: "9:30AM",
  courtRoomId: "...",
  // ... other fields
});
```

## Case Number Formats

| Court | Format | Example |
|-------|--------|---------|
| High Court Criminal | `HAC XXX/YYYY` | HAC 179/2024 |
| High Court Civil | `HBC XXX/YYYY` | HBC 188/2023 |
| Court of Appeal | `ABU XXX/YY` | ABU 002/20 |
| Magistrates | `XXX/YY` | 707/21 |

## Hearing Action Types

```typescript
type ActionType = 
  | "MENTION"                    // Case management
  | "HEARING"                    // General hearing
  | "TRIAL"                      // Main trial
  | "CONTINUATION OF TRIAL"      // Multi-day trial
  | "VOIR DIRE HEARING"          // Evidence admissibility
  | "PRE-TRIAL CONFERENCE"       // Pre-trial prep
  | "BAIL HEARING"               // Bail consideration
  | "RULING"                     // Decision delivery
  | "FIRST CALL"                 // Initial appearance
  | "SENTENCING";                // Sentence delivery
```

## Court Levels

```typescript
type CourtLevel = 
  | "court_of_appeal"
  | "high_court"
  | "magistrates"
  | "tribunal";
```

## Party Structure

```typescript
interface CaseParties {
  prosecution?: { name: string; counsel?: string }[];
  defense?: { name: string; counsel?: string }[];
  plaintiff?: { name: string; counsel?: string }[];
  defendant?: { name: string; counsel?: string }[];
  appellant?: { name: string; counsel?: string }[];
  respondent?: { name: string; counsel?: string }[];
}
```

## New Tables

### court_rooms
```typescript
{
  id: string;
  organisationId: string;
  name: string;              // "HIGH COURT ROOM NO. 2"
  code: string;              // "HC-2"
  courtLevel: string;
  location?: string;
  capacity?: number;
  isActive: boolean;
}
```

### legal_representatives
```typescript
{
  id: string;
  organisationId: string;
  name: string;              // "LEGAL AID COMMISSION"
  type: string;              // "law_firm", "legal_aid", "government"
  firmName?: string;
  email?: string;
  phone?: string;
  practiceAreas?: string[];
  isActive: boolean;
}
```

### daily_cause_lists
```typescript
{
  id: string;
  organisationId: string;
  listDate: Date;
  courtLevel: string;
  presidingOfficerId: string;
  presidingOfficerTitle?: string;  // "HON. MR. JUSTICE GOUNDAR"
  courtRoomId?: string;
  sessionTime?: string;            // "9:30AM"
  status: string;                  // "draft", "published"
}
```

## Enhanced Fields

### cases table
```typescript
{
  // New fields
  caseNumber: string;              // Auto-generated
  courtLevel: string;
  division?: string;
  parties: CaseParties;            // JSON
  assignedJudgeId?: string;
  assignedClerkId?: string;
  filedDate: Date;
  firstHearingDate?: Date;
  closedDate?: Date;
  offences?: string[];             // JSON array
  notes?: string;
  updatedAt: Date;
}
```

### hearings table
```typescript
{
  // New fields
  scheduledDate: Date;
  scheduledTime: string;           // "9:30AM"
  estimatedDuration?: number;
  courtRoomId?: string;
  actionType: string;              // MENTION, TRIAL, etc.
  status: string;
  magistrateId?: string;
  clerkId?: string;
  outcome?: string;
  nextActionRequired?: string;
  bailConsidered?: boolean;
  bailDecision?: string;
  bailAmount?: number;
  bailConditions?: string;
  minutes?: string;
  notes?: string;
  createdBy?: string;
  updatedAt: Date;
}
```

### appeals table
```typescript
{
  // New fields
  originalCaseId: string;          // Link to lower court
  appealCaseId?: string;           // New appeal case
  appealType: string;
  grounds?: string;
  status: string;
  appellantId?: string;
  appellantCounsel?: string;
  respondentCounsel?: string;
  filedDate: Date;
  hearingDate?: Date;
  decisionDate?: Date;
  decision?: string;
  orders?: string;
  updatedAt: Date;
}
```

### user table
```typescript
{
  // New fields
  judicialTitle?: string;          // "Justice", "Magistrate"
  designation?: string;            // "Judge", "Prosecutor"
}
```

### organisations table
```typescript
{
  // New fields
  courtLevel?: string;
  courtType?: string;
  jurisdiction?: string;
}
```

## Useful Queries

### Get upcoming hearings
```typescript
const upcomingHearings = await db
  .select()
  .from(hearings)
  .where(
    and(
      eq(hearings.status, "scheduled"),
      gte(hearings.scheduledDate, new Date())
    )
  )
  .orderBy(hearings.scheduledDate);
```

### Get cases by court level
```typescript
const highCourtCases = await db
  .select()
  .from(cases)
  .where(
    and(
      eq(cases.courtLevel, "high_court"),
      eq(cases.organisationId, orgId)
    )
  );
```

### Get judge's schedule
```typescript
const judgeSchedule = await db
  .select()
  .from(hearings)
  .where(
    and(
      eq(hearings.judgeId, judgeId),
      eq(hearings.scheduledDate, targetDate)
    )
  )
  .orderBy(hearings.scheduledTime);
```

### Get courtroom availability
```typescript
const availability = await db
  .select()
  .from(courtRooms)
  .where(
    and(
      eq(courtRooms.organisationId, orgId),
      eq(courtRooms.isActive, true)
    )
  );
```

## Database Views

### v_upcoming_hearings
Pre-joined view of hearings with case and judge details:
```sql
SELECT * FROM v_upcoming_hearings
WHERE scheduled_date >= CURRENT_DATE
ORDER BY scheduled_date, scheduled_time;
```

### v_active_cases
Active cases with next hearing date:
```sql
SELECT * FROM v_active_cases
WHERE organisation_id = 'org-id'
ORDER BY filed_date DESC;
```

## Common Legal Representatives

| Name | Type | Practice Areas |
|------|------|---------------|
| DPP | government | criminal |
| LEGAL AID COMMISSION | legal_aid | criminal, civil, family |
| MISHRA PRAKASH & ASSOCIATES | law_firm | civil, property |
| SEN LAWYERS | law_firm | civil, appeals |
| VOSAROGO LAWYERS | law_firm | criminal |

## Validation

```typescript
import { validateCaseNumber, parseCaseNumber } from "@/lib/utils/case-number";

// Validate case number
const isValid = validateCaseNumber("HAC 179/2024", "high_court", "criminal");

// Parse case number
const parsed = parseCaseNumber("HAC 179/2024");
// Returns: { prefix: "HAC", sequence: 179, year: 2024 }
```

## Migration Notes

- ✅ All existing data preserved
- ✅ New required fields have defaults
- ✅ Backward compatible
- ✅ No breaking changes
- ✅ Indexes added for performance

## File Locations

| Type | Location |
|------|----------|
| Schema | `/lib/drizzle/schema/db-schema.ts` |
| Migration | `/migrations/004_fiji_court_system_support.sql` |
| Utilities | `/lib/utils/case-number.ts` |
| Seed Script | `/scripts/seed-fiji-courts.ts` |
| Documentation | `/documentation/11-fiji-court-system-redesign.md` |
| Summary | `/documentation/12-fiji-implementation-summary.md` |
| Diagrams | `/documentation/13-fiji-system-diagrams.md` |

## Need Help?

1. Check full documentation: `/documentation/11-fiji-court-system-redesign.md`
2. Review court samples: `/court-file-samples/`
3. See diagrams: `/documentation/13-fiji-system-diagrams.md`
4. Run seed script: `npx ts-node scripts/seed-fiji-courts.ts`

---

**Status:** ✅ Ready for Implementation  
**Backward Compatible:** Yes  
**Breaking Changes:** None
